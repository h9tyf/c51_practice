C51 COMPILER V9.60.0.0   MAIN                                                              01/31/2021 18:06:32 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OMF2 OPTIMIZE(8,SPEED) BROWSE DEBUG PRINT(.\Listings\main.lst) TA
                    -BS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          
   2          #include "reg52.h"  
   3          #include <intrins.h>
   4          
   5          sfr AUXR =0x8E;
   6          int SysTick = 0;
   7          
   8          typedef unsigned char u8;
   9          
  10          u8 digital_tube[8] = {0, 0, 0, 0, 0, 0, 0, 0};
  11          
  12          int display(int i){
  13   1        u8 a[10] = {0xC0,0xF9,0xA4,0xB0,0x99,0x92,0x82,0xF8,0x80,0x90};
  14   1        return a[i];
  15   1      }
  16          
  17          
  18          void LatchControl(int num, int value)
  19          {
  20   1        P0 = value;
  21   1        _nop_();
  22   1        P2 = ((P2&0x1f)|(num<<5));
  23   1        _nop_();
  24   1        P2 &= 0x1f;
  25   1      }
  26          
  27          u8 state = 0;
  28          int count = 0;
  29          u8 change = 0;
  30          
  31          void func(void) interrupt 1
  32          {
  33   1        SysTick++;
  34   1        LatchControl(7, display(digital_tube[state]));
  35   1        
  36   1        LatchControl(6, 1<<(7-state));
  37   1        
  38   1        state = (state + 1) % 8;
  39   1      }
  40          
  41          void Timer0Init(void)
  42          {
  43   1        AUXR |= 0x80;  
  44   1        TMOD &= 0xF0;
  45   1        //TMOD |= 0x01;
  46   1        TL0 = 0xCD;   //??????
  47   1        TH0 = 0xD4;   //??????
  48   1        TF0 = 0;
  49   1        TR0 = 1;
  50   1        IE0 = 1;
  51   1        ET0 = 1;
  52   1      }
  53          
  54          long tube_to_num(){
C51 COMPILER V9.60.0.0   MAIN                                                              01/31/2021 18:06:32 PAGE 2   

  55   1        long ans = 0;
  56   1        long n = 1;
  57   1        u8 i;
  58   1        for(i = 0; i < 8; i++){
  59   2          ans += digital_tube[i] * n;
  60   2          n *= 10;
  61   2        }
  62   1        return ans;
  63   1      }
  64          
  65          void num_to_tube(long num){
  66   1        u8 i;
  67   1        for(i = 0; i < 8; i++){
  68   2          digital_tube[i] = num % 10;
  69   2          num = num / 10;
  70   2        }
  71   1      }
  72          
  73          void update()
  74          {
  75   1        long num = tube_to_num();
  76   1        if(num == 99999999){
  77   2          num = 0;
  78   2        } else {
  79   2          num += 1;
  80   2        }
  81   1        num_to_tube(num);
  82   1      }
  83          
  84          void main(void)
  85          {
  86   1        LatchControl(4, 0xff);
  87   1        EA = 1;
  88   1        ET0 = 1;
  89   1        Timer0Init();
  90   1        while(1){
  91   2          long tickBkp = SysTick;
  92   2          
  93   2          if(tickBkp % 1000 == 0){
  94   3            update();
  95   3          }
  96   2          
  97   2          while(tickBkp == SysTick);
  98   2        }
  99   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    560    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14      34
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
